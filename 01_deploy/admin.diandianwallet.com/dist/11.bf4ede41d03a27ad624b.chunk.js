webpackJsonp([11],{219:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(301),o=r.n(n);for(var a in n)"default"!==a&&function(e){r.d(t,e,function(){return n[e]})}(a);var i=r(396),s=r.n(i),l=!1;var c=function(e){l||r(394)},d=r(0)(o.a,s.a,!1,c,"data-v-55155e9f",null);d.options.__file="src\\views\\system\\Role.vue",t.default=d.exports},301:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(22),o=r(11);function a(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}t.default={data:function(){var e=this;return{pageNum:null,currentPageIdx:1,permissionWrapper:!1,ifLoading:!0,deleteRoleArr:[],delRole:!1,deleteRoleID:null,fixedRolePermission:[],submitArr:[],allPermission:[],roleId:null,showAddRole:!1,showForm:!1,formValidate:{name:null,roleDscrp:null},ruleValidate:{name:[{required:!0,message:this.$t("rolemanagement.rolenamecannotbeempty"),trigger:"blur"}]},column_frist:[{title:"ID",key:"id",width:80},{title:this.$t("rolemanagement.rolename1"),key:"role"},{title:this.$t("systeminformationmaintenance.remarks"),key:"description"},{title:this.$t("perpetualcontractcurrencystandardmanagement.operation"),render:function(t,r){return t("div",[t("Button",{props:{type:"info",size:"small"},style:{marginRight:"5px"},on:{click:function(){e.showForm=!0,e.filterPermission=[],e.roleId=r.row.id,e.formValidate.name=r.row.role,e.formValidate.roleDscrp=r.row.description;var t=JSON.parse((0,o.getStore)("allPermission"));t.forEach(function(e){e.checked=!1}),(0,n.queryRolePermission)({roleId:r.row.id}).then(function(r){if(r.code)e.$Message.error(e.$t("rolemanagement.dataacquisitionexception"));else{var n=[];r.data.forEach(function(e){e.subMenu.forEach(function(e){n.push({id:e.id,parentId:e.parentId})})}),t.forEach(function(e){e.children.forEach(function(e){n.find(function(t){return t.id===e.id})&&(e.checked=!0)})}),e.permissions=t}})}}},e.$t("perpetualcontractcurrencystandardmanagement.modify")),t("Button",{props:{type:"error",size:"small"},on:{click:function(){console.log(r.row.id),e.deleteRoleID=r.row.id,e.delRoleBtn()}}},e.$t("secondcontractcompensationsetting.delete"))])}}],permissions:[],userpage:[]}},methods:{changePage:function(e){this.currentPageIdx=e,this.refreshPage({pageNo:e,pageSize:10})},deleteRole:function(){var e=this;(0,n.deleteRole)({id:this.deleteRoleID}).then(function(t){t.code?e.$Message.error(t.message):(e.$Message.success(e.$t("currencysetting.deletionsucceeded")),e.refreshPage())})},delRoleBtn:function(){this.delRole=!0},addRoleBtn:function(){var e=this;this.submitArr=[],this.formValidate.roleDscrp=this.formValidate.name=null,this.showAddRole=!0,this.allPermission=JSON.parse((0,o.getStore)("allPermission")),this.allPermission.forEach(function(t,r){e.submitArr.push(t.id),void 0!==t.children&&t.children.forEach(function(t){e.submitArr.push(t.id)})})},addRoleTree:function(e){var t=this,r=[];this.submitArr=[],e.forEach(function(e){t.allPermission.forEach(function(t,n){t.children.forEach(function(n){n.id===e.id&&r.push(t.id)})})});var n=[].concat(a(new Set(r))),o=[];e.forEach(function(e){e.children||o.push(e.id)}),this.submitArr=[].concat(a(n),o)},addRole:function(){var e,t=this;-1===this.submitArr.indexOf(8)&&(e=this.submitArr).push.apply(e,[8,11,12,13,66,90,116]);if(""!==this.formValidate.name&&this.formValidate.name){this.permissionWrapper=!0;var r={role:this.formValidate.name,description:this.formValidate.roleDscrp,permissions:this.submitArr};(0,n.addAuditRole)(r).then(function(e){e.code?t.$Message.error(e.message):(t.$Message.success(t.$t("perpetualcontractcurrencystandardmanagement.operationsucceeded")),t.refreshPage()),t.permissionWrapper=!1}).catch(function(e){console.log(e)})}else this.$Message.warning(this.$t("jiao-se-ming-cheng-bu-neng-wei-kong"))},selectArrayFn:function(e){var t=[];e.forEach(function(e){e.children&&t.push(e)});var r=[];return t.forEach(function(e){r.push(e.id),e.children.forEach(function(e){r.push(e.id)})}),r},fixTreeArray:function(e){var t=[];e.forEach(function(e){t.push(e.id),t.push(e.parentId)}),this.fixedRolePermission=[].concat(a(new Set(t)))},confirmChange:function(){var e,t=this;(this.permissionWrapper=!0,-1===this.fixedRolePermission.indexOf(8))&&(e=this.fixedRolePermission).push.apply(e,[8,11,12,13,66,90,116]);var r={id:this.roleId,role:this.formValidate.name,description:this.formValidate.roleDscrp,permissions:this.fixedRolePermission};(0,n.addAuditRole)(r).then(function(e){e.code?t.$Message.error(t.$t("rolemanagement.rolepermissionmodificationfailed")):(t.$Message.success(t.$t("rolemanagement.rolepermissionsmodifiedsuccessfully")),t.refreshPage()),t.permissionWrapper=!1})},cancelChange:function(){this.$Message.info(this.$t("versionmanagement.modificationcanceled"))},getAllPermissionFn:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=[];(0,n.getAllPermission)().then(function(r){r.code||r.data.forEach(function(r){var n={title:r.title,id:r.id,checked:e,children:[]};r.subMenu.forEach(function(e){var t={id:e.id,title:e.title,parentId:e.parentId};n.children.push(t)}),t.push(n),(0,o.removeStore)("allPermission"),(0,o.setStore)("allPermission",t)})})},refreshPageManual:function(){this.refreshPage()},refreshPage:function(){var e=this;this.ifLoading=!0,(0,n.roleManage)().then(function(t){t.code?e.$Message.error(t.message):(e.userpage=t.data.content,e.ifLoading=!1)},function(e){console.log(e)})}},created:function(){this.getAllPermissionFn(),this.refreshPage()},filters:{filterPer:function(e){return e.forEach(function(e){e.children.length>0&&e.children.forEach(function(e){116!==e.id&&90!==e.id||(e.disableCheckbox=!0,e.checked=!0)})}),e}}}},394:function(e,t,r){var n=r(395);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);r(5)("5e17b418",n,!1,{})},395:function(e,t,r){(e.exports=r(4)(!1)).push([e.i,"\n.permissionWrapper[data-v-55155e9f] {\n  position: absolute;\n  z-index: 10;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  background-color: rgba(0, 0, 0, 0.2);\n}\n.permissionWrapper p[data-v-55155e9f] {\n  position: absolute;\n  top: 50%;\n  left: 45%;\n  transform: -50%;\n  font-size: 25px;\n  font-style: '\\9ED1\\4F53';\n  text-align: center;\n  color: #fff;\n}\n",""])},396:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Card",[r("p",{attrs:{slot:"title"},slot:"title"},[e._v("\n        "+e._s(e.$t("rolemanagement.rolemanagement"))+" "),r("Button",{attrs:{type:"primary",size:"small"},on:{click:e.refreshPageManual}},[r("Icon",{attrs:{type:"refresh"}}),e._v("\n            "+e._s(e.$t("perpetualcontractcurrencystandardmanagement.refresh"))+" ")],1)],1),e._v(" "),r("Row",{staticClass:"functionWrapper"},[r("div",{staticClass:"btnsWrapper clearfix"},[r("Button",{attrs:{type:"primary"},on:{click:e.addRoleBtn}},[e._v(e._s(e.$t("rolemanagement.addrole")))])],1)]),e._v(" "),r("Modal",{attrs:{title:e.$t("rolemanagement.deleterole")},on:{"on-ok":e.deleteRole,"on-cancel":function(t){e.$Message.info(this.$t("rolemanagement.cancel"))}},model:{value:e.delRole,callback:function(t){e.delRole=t},expression:"delRole"}},[r("p",[e._v(e._s(e.$t("rolemanagement.deletethisrole")))])]),e._v(" "),r("Modal",{attrs:{title:e.$t("rolemanagement.addrole")},on:{"on-ok":e.addRole},model:{value:e.showAddRole,callback:function(t){e.showAddRole=t},expression:"showAddRole"}},[r("Form",{attrs:{"label-position":"right",model:e.formValidate,"label-width":100,rules:e.ruleValidate}},[r("FormItem",{attrs:{label:e.$t("rolemanagement.rolename"),prop:"name"}},[r("Input",{model:{value:e.formValidate.name,callback:function(t){e.$set(e.formValidate,"name",t)},expression:"formValidate.name"}})],1),e._v(" "),r("FormItem",{attrs:{label:e.$t("rolemanagement.roledescription")}},[r("Input",{attrs:{type:"textarea"},model:{value:e.formValidate.roleDscrp,callback:function(t){e.$set(e.formValidate,"roleDscrp",t)},expression:"formValidate.roleDscrp"}})],1)],1),e._v(" "),r("br"),e._v(" "),r("Tree",{attrs:{data:e.allPermission,"show-checkbox":""},on:{"on-check-change":e.addRoleTree}})],1),e._v(" "),r("Row",[r("Table",{attrs:{columns:e.column_frist,data:e.userpage,loading:e.ifLoading,border:""}})],1),e._v(" "),r("Modal",{attrs:{title:e.$t("rolemanagement.modifypermissions")},on:{"on-ok":e.confirmChange,"on-cancel":e.cancelChange},model:{value:e.showForm,callback:function(t){e.showForm=t},expression:"showForm"}},[r("Form",[r("FormItem",{attrs:{label:e.$t("rolemanagement.roledescription")}},[r("Input",{attrs:{type:"textarea"},model:{value:e.formValidate.roleDscrp,callback:function(t){e.$set(e.formValidate,"roleDscrp",t)},expression:"formValidate.roleDscrp"}})],1)],1),e._v(" "),r("Tree",{attrs:{data:e._f("filterPer")(e.permissions),"show-checkbox":""},on:{"on-check-change":e.fixTreeArray}})],1),e._v(" "),r("Row",{staticClass:"pageWrapper"},[r("Page",{staticClass:"buttomPage",attrs:{total:e.pageNum,current:e.currentPageIdx,"show-elevator":""},on:{"on-change":e.changePage}})],1)],1),e._v(" "),e.permissionWrapper?r("div",{staticClass:"permissionWrapper"},[r("p",[e._v(e._s(e.$t("rolemanagement.dataupdating")))])]):e._e()],1)};n._withStripped=!0;var o={render:n,staticRenderFns:[]};t.default=o}});